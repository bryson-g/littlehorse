"use strict";(self.webpackChunklh_site=self.webpackChunklh_site||[]).push([[5919],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>c});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),u=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},p=function(e){var t=u(e.components);return n.createElement(o.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},k=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(a),k=r,c=d["".concat(o,".").concat(k)]||d[k]||m[k]||i;return a?n.createElement(c,s(s({ref:t},p),{},{components:a})):n.createElement(c,s({ref:t},p))}));function c(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,s=new Array(i);s[0]=k;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[d]="string"==typeof e?e:r,s[1]=l;for(var u=2;u<i;u++)s[u]=a[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},5162:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(7294),r=a(6010);const i={tabItem:"tabItem_Ymn6"};function s(e){let{children:t,hidden:a,className:s}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(i.tabItem,s),hidden:a},t)}},4866:(e,t,a)=>{a.d(t,{Z:()=>y});var n=a(7462),r=a(7294),i=a(6010),s=a(2466),l=a(6550),o=a(1980),u=a(7392),p=a(12);function d(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:a,attributes:n,default:r}}=e;return{value:t,label:a,attributes:n,default:r}}))}function m(e){const{values:t,children:a}=e;return(0,r.useMemo)((()=>{const e=t??d(a);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function k(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function c(e){let{queryString:t=!1,groupId:a}=e;const n=(0,l.k6)(),i=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,o._X)(i),(0,r.useCallback)((e=>{if(!i)return;const t=new URLSearchParams(n.location.search);t.set(i,e),n.replace({...n.location,search:t.toString()})}),[i,n])]}function h(e){const{defaultValue:t,queryString:a=!1,groupId:n}=e,i=m(e),[s,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!k({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:i}))),[o,u]=c({queryString:a,groupId:n}),[d,h]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,i]=(0,p.Nk)(a);return[n,(0,r.useCallback)((e=>{a&&i.set(e)}),[a,i])]}({groupId:n}),f=(()=>{const e=o??d;return k({value:e,tabValues:i})?e:null})();(0,r.useLayoutEffect)((()=>{f&&l(f)}),[f]);return{selectedValue:s,selectValue:(0,r.useCallback)((e=>{if(!k({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),h(e)}),[u,h,i]),tabValues:i}}var f=a(2389);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function T(e){let{className:t,block:a,selectedValue:l,selectValue:o,tabValues:u}=e;const p=[],{blockElementScrollPositionUntilNextRender:d}=(0,s.o5)(),m=e=>{const t=e.currentTarget,a=p.indexOf(t),n=u[a].value;n!==l&&(d(t),o(n))},k=e=>{let t=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const a=p.indexOf(e.currentTarget)+1;t=p[a]??p[0];break}case"ArrowLeft":{const a=p.indexOf(e.currentTarget)-1;t=p[a]??p[p.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":a},t)},u.map((e=>{let{value:t,label:a,attributes:s}=e;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>p.push(e),onKeyDown:k,onClick:m},s,{className:(0,i.Z)("tabs__item",b.tabItem,s?.className,{"tabs__item--active":l===t})}),a??t)})))}function g(e){let{lazy:t,children:a,selectedValue:n}=e;const i=(Array.isArray(a)?a:[a]).filter(Boolean);if(t){const e=i.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},i.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function N(e){const t=h(e);return r.createElement("div",{className:(0,i.Z)("tabs-container",b.tabList)},r.createElement(T,(0,n.Z)({},e,t)),r.createElement(g,(0,n.Z)({},e,t)))}function y(e){const t=(0,f.Z)();return r.createElement(N,(0,n.Z)({key:String(t)},e))}},8784:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>c,frontMatter:()=>l,metadata:()=>u,toc:()=>d});var n=a(7462),r=(a(7294),a(3905)),i=a(4866),s=a(5162);const l={},o="Handling User Tasks",u={unversionedId:"developer-guide/grpc/user-tasks",id:"developer-guide/grpc/user-tasks",title:"Handling User Tasks",description:"User Tasks enable a ThreadRun to block until a human user provides some input into the workflow. Additionally, User Tasks have several useful hooks such as automatic reassignment, reminders, and auditing capabilities.",source:"@site/docs/05-developer-guide/09-grpc/20-user-tasks.md",sourceDirName:"05-developer-guide/09-grpc",slug:"/developer-guide/grpc/user-tasks",permalink:"/littlehorse/docs/developer-guide/grpc/user-tasks",draft:!1,tags:[],version:"current",sidebarPosition:20,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Posting ExternalEvents",permalink:"/littlehorse/docs/developer-guide/grpc/posting-external-events"},next:{title:"Operations",permalink:"/littlehorse/docs/operations/"}},p={},d=[{value:"<code>UserTaskRun</code> Lifecycle",id:"usertaskrun-lifecycle",level:2},{value:"Search for <code>UserTaskRun</code>s",id:"search-for-usertaskruns",level:2},{value:"Display a <code>UserTaskRun</code>",id:"display-a-usertaskrun",level:2},{value:"Complete a <code>UserTaskRun</code>",id:"complete-a-usertaskrun",level:2},{value:"Re-Assign a <code>UserTaskRun</code>",id:"re-assign-a-usertaskrun",level:2},{value:"Cancel a <code>UserTaskRun</code>",id:"cancel-a-usertaskrun",level:2}],m={toc:d},k="wrapper";function c(e){let{components:t,...a}=e;return(0,r.kt)(k,(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"handling-user-tasks"},"Handling User Tasks"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/concepts/user-tasks"},"User Tasks")," enable a ",(0,r.kt)("inlineCode",{parentName:"p"},"ThreadRun")," to block until a human user provides some input into the workflow. Additionally, User Tasks have several useful hooks such as automatic reassignment, reminders, and auditing capabilities."),(0,r.kt)("p",null,"This page shows you how to interact with a ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," on an already-running ",(0,r.kt)("inlineCode",{parentName:"p"},"WfRun"),"."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"For documentation about how to insert a ",(0,r.kt)("inlineCode",{parentName:"p"},"USER_TASK")," node into your ",(0,r.kt)("inlineCode",{parentName:"p"},"WfSpec"),", please refer to the ",(0,r.kt)("a",{parentName:"p",href:"/docs/developer-guide/wfspec-development/user-tasks"},(0,r.kt)("inlineCode",{parentName:"a"},"WfSpec")," development documentation"),".")),(0,r.kt)("p",null,"Note that LittleHorse does not provide an out-of-the-box implementation of a User Task Manager application. This is because it would likely be of limited use to our users, because the implementation of User Task Applications is highly use-case specific. For example, each of the following considerations might be handled vastly differently depending on the application:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Presentation:")," is the user task form presented in a mobile app, standalone internal web application, or embedded into a customer-facing site?"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Identity Management:")," what system is used to manage and determine the identity of the person executing User Tasks?"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Look and Feel:")," what is the style of the actual page?"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Access Permisions:")," while the ",(0,r.kt)("inlineCode",{parentName:"li"},"userGroup")," field of a ",(0,r.kt)("inlineCode",{parentName:"li"},"UserTaskRun")," is useful for determining who may execute a ",(0,r.kt)("inlineCode",{parentName:"li"},"UserTaskRun"),", how should the Task Manager application determine who can perform additional acctions, such as reassignment and viewing audit information?")),(0,r.kt)("p",null,"While those considerations are left to the user of LittleHorse, User Tasks still provide an incredibly valuable tool to our users, specifically:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Direct integrations with the ",(0,r.kt)("inlineCode",{parentName:"li"},"WfSpec")),(0,r.kt)("li",{parentName:"ul"},"Built-in reassignment and reminder capabilities"),(0,r.kt)("li",{parentName:"ul"},"Built-in search capabilities.")),(0,r.kt)("p",null,"This documentation explains everything you need in order to build your own application-specific User Tasks integration."),(0,r.kt)("h2",{id:"usertaskrun-lifecycle"},(0,r.kt)("inlineCode",{parentName:"h2"},"UserTaskRun")," Lifecycle"),(0,r.kt)("p",null,"In order to use User Tasks, you must first create a ",(0,r.kt)("inlineCode",{parentName:"p"},"WfSpec")," that has a ",(0,r.kt)("inlineCode",{parentName:"p"},"USER_TASK")," node in it, for example by using the ",(0,r.kt)("inlineCode",{parentName:"p"},"WorkflowThread#assignUserTask()")," method (see our ",(0,r.kt)("a",{parentName:"p",href:"/docs/developer-guide/wfspec-development/user-tasks"},(0,r.kt)("inlineCode",{parentName:"a"},"WfSpec")," Development Docs"),")."),(0,r.kt)("p",null,"When a ",(0,r.kt)("inlineCode",{parentName:"p"},"ThreadRun")," arrives at such a ",(0,r.kt)("inlineCode",{parentName:"p"},"Node"),", then a ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," object is created in the LittleHorse Data Store. The ",(0,r.kt)("inlineCode",{parentName:"p"},"ThreadRun"),' will "block" at that ',(0,r.kt)("inlineCode",{parentName:"p"},"Node")," until the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," is either completed or cancelled. When the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," is completed, the ",(0,r.kt)("inlineCode",{parentName:"p"},"NodeRun")," returns an output which is a ",(0,r.kt)("inlineCode",{parentName:"p"},"JSON_OBJ")," containing a key-value pair for every field in the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskDef")," (in plain English, this is just one key-value for each field in the User Task form). When the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," is cancelled, an ",(0,r.kt)("inlineCode",{parentName:"p"},"EXCEPTION")," is propagated to the ",(0,r.kt)("inlineCode",{parentName:"p"},"ThreadRun"),"."),(0,r.kt)("p",null,"The only way to Complete a ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," is via the ",(0,r.kt)("inlineCode",{parentName:"p"},"rpc CompleteUserTaskRun")," endpoint on the LH Server. A ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," may be cancelled either by the ",(0,r.kt)("inlineCode",{parentName:"p"},"rpc CancelUserTaskRun")," or by lifecycle hooks built-in to the ",(0,r.kt)("inlineCode",{parentName:"p"},"WfSpec"),"."),(0,r.kt)("p",null,"A ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," may be in one of the four statuses below:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"UNASSIGNED"),": the ",(0,r.kt)("inlineCode",{parentName:"li"},"UserTaskRun")," does not have a specific ",(0,r.kt)("inlineCode",{parentName:"li"},"user_id")," set. In this case, ",(0,r.kt)("inlineCode",{parentName:"li"},"user_group")," must be set."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ASSIGNED"),": the ",(0,r.kt)("inlineCode",{parentName:"li"},"UserTaskRun")," has a specific ",(0,r.kt)("inlineCode",{parentName:"li"},"user_id")," set, and may have a ",(0,r.kt)("inlineCode",{parentName:"li"},"user_group")," set as well."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"DONE"),": the ",(0,r.kt)("inlineCode",{parentName:"li"},"UserTaskRun")," has been completed."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"CANCELLED"),": the ",(0,r.kt)("inlineCode",{parentName:"li"},"UserTaskRun")," has been cancelled either by a manual ",(0,r.kt)("inlineCode",{parentName:"li"},"rpc CancelUserTaskRun")," or by a built-in User Task lifecycle hook.")),(0,r.kt)("h2",{id:"search-for-usertaskruns"},"Search for ",(0,r.kt)("inlineCode",{parentName:"h2"},"UserTaskRun"),"s"),(0,r.kt)("p",null,"Before you can do anything useful with User Tasks, you need to be able to search for a list of ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun"),"'s matching certain criteria. The endpoint ",(0,r.kt)("inlineCode",{parentName:"p"},"rpc SearchUserTaskRun")," allows you to do this."),(0,r.kt)("p",null,"The endpoint definition is provided below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},"service LittleHorse {\n  rpc SearchUserTaskRun(SearchUserTaskRunRequest) returns (UserTaskRunIdList) {}\n}\n\nmessage SearchUserTaskRunRequest {\n  optional bytes bookmark = 1;\n  optional int32 limit = 2;\n\n  optional UserTaskRunStatus status = 3;\n  optional string user_task_def_name = 4;\n\n  optional string user_id = 5;\n  optional string user_group = 6;\n\n  optional google.protobuf.Timestamp earliest_start = 7;\n  optional google.protobuf.Timestamp latest_start = 8;\n}\n\nmessage UserTaskRunIdList {\n  repeated UserTaskRunId results = 1;\n  optional bytes bookmark = 2;\n}\n")),(0,r.kt)("p",null,"Note that there are six filters that can be provided:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"status"),": an enum of either ",(0,r.kt)("inlineCode",{parentName:"li"},"DONE"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"UNASSIGNED"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"ASSIGNED"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"CANCELLED"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"user_task_def_name"),": the name of the associated ",(0,r.kt)("inlineCode",{parentName:"li"},"UserTaskDef"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"user_id"),": Only returns ",(0,r.kt)("inlineCode",{parentName:"li"},"UserTaskRun"),"'s assigned to a specific user."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"user_group"),": only returns ",(0,r.kt)("inlineCode",{parentName:"li"},"UserTaskRun"),"'s assigned to a group."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"earliest_start"),": only returns ",(0,r.kt)("inlineCode",{parentName:"li"},"UserTaskRun"),"'s created after this date."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"latest_start"),": only returns ",(0,r.kt)("inlineCode",{parentName:"li"},"UserTaskRun"),"'s created before this date.")),(0,r.kt)("p",null,"All fields are additive; meaning that you can specify any combination of the fields, and only ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun"),"'s matching ",(0,r.kt)("em",{parentName:"p"},"all")," of the criteria will be"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"user_id")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"user_group")," fields are ",(0,r.kt)("em",{parentName:"p"},"not")," managed by LittleHorse. Rather, they are intended to allow the user of LittleHorse to pass values managed by an external identity provider. This allows User Tasks to support a wide array of identity management systems.")),(0,r.kt)("p",null,"See below for an example of searching for ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun"),"'s with the following criteria:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Assigned to the ",(0,r.kt)("inlineCode",{parentName:"li"},"jedi-council")," group, and specifically executed by ",(0,r.kt)("inlineCode",{parentName:"li"},"Obi-Wan")),(0,r.kt)("li",{parentName:"ul"},"Created in the past week"),(0,r.kt)("li",{parentName:"ul"},"Already in the ",(0,r.kt)("inlineCode",{parentName:"li"},"DONE")," status"),(0,r.kt)("li",{parentName:"ul"},"Of the type ",(0,r.kt)("inlineCode",{parentName:"li"},"approve-funds-for-mission"),".")),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"java",label:"Java",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'LittleHorseBlockingStub client = ...;\n\nTimestamp oneWeekAgo = Timestamp.newBuilder()\n        .setSeconds(Instant.now().minus(7, ChronoUnit.DAYS).getEpochSecond())\n        .build();\n\n// You can omit certain search criteria here if desired.\nSearchUserTaskRunRequest req = SearchUserTaskRunRequest.newBuilder()\n        .setUserId("obi-wan")\n        .setUserGroup("jedi-council")\n        .setUserTaskDefName("approve-funds-for-mission")\n        .setStatus(UserTaskStatus.DONE)\n        .setEarliestCreateTime(oneWeekAgo)\n        .build();\n\nUserTaskRunIdList results = client.searchUserTaskRun(req);\n'))),(0,r.kt)(s.Z,{value:"go",label:"Go",mdxType:"TabItem"},(0,r.kt)("p",null,"Go example coming soon. However, it should be highly similar to the Java example above.")),(0,r.kt)(s.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("p",null,"Python example coming soon. However, it should be highly similar to the Java example above."))),(0,r.kt)("h2",{id:"display-a-usertaskrun"},"Display a ",(0,r.kt)("inlineCode",{parentName:"h2"},"UserTaskRun")),(0,r.kt)("p",null,"Now that you've found some relevant ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun"),"'s that you want to display in your application, how do you show them? This is particularly important to understand when building a generic User Task Manager."),(0,r.kt)("p",null,"First, the ",(0,r.kt)("inlineCode",{parentName:"p"},"rpc GetUserTaskRun")," request can be used to get the details for of a ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun"),". To use this request, you need a ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRunId")," (see the note on searching above!)."),(0,r.kt)("p",null,"Once you have the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun"),", you can inspect the results (if it's already completed). If you are trying to develop a frontend to execute the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun"),", you can iterate through the ",(0,r.kt)("inlineCode",{parentName:"p"},"fields")," of the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskDef")," and determine what fields are to be displayed."),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"java",label:"Java",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'LittleHorseBlockingStub client = ...;\nUserTaskRunId id = ...; // For example, via searching as above\n\nUserTaskRun userTaskRun = client.getUserTaskRun(id);\n\n// See current owners\nString currentUserId = userTaskRun.hasUserId() ? userTaskRun.getUserId() : null;\nString currentUserGroup = userTaskRun.hasUserGroup() ? userTaskRun.getUserGroup() : null;\n\n// See results. If the userTaskRun is not completed, the map will be empty.\n// Otherwise, there will be a result for every required field.\nMap<String, VariableValue> results = userTaskRun.getResultsMap();\n\n// See the fields on the UserTaskDef. This is useful for front-end\'s which need\n// to dynamically display forms that accept the input.\nUserTaskDefId userTaskDefId = userTaskRun.getUserTaskDefId();\nUserTaskDef userTaskDef = client.getUserTaskDef(userTaskDefId);\nfor (UserTaskField field : userTaskDef.getFieldsList()) {\n    System.out.println("Field %s has type %s".formatted(field.getName(), field.getType()));\n}\n'))),(0,r.kt)(s.Z,{value:"go",label:"Go",mdxType:"TabItem"},(0,r.kt)("p",null,"Go example coming soon. However, it should be highly similar to the Java example above.")),(0,r.kt)(s.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("p",null,"Python example coming soon. However, it should be highly similar to the Java example above."))),(0,r.kt)("h2",{id:"complete-a-usertaskrun"},"Complete a ",(0,r.kt)("inlineCode",{parentName:"h2"},"UserTaskRun")),(0,r.kt)("p",null,"To complete a ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun"),", you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"rpc CompleteUserTaskRun"),". The protobuf for the call is as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"rpc CompleteUserTaskRun(CompleteUserTaskRunRequest) returns (google.protobuf.Empty) {}\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"CompleteUserTaskRunRequest")," message is defined as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},"message CompleteUserTaskRunRequest {\n  UserTaskRunId user_task_run_id = 1;\n  map<string, VariableValue> results = 2;\n  string user_id = 3;\n}\n")),(0,r.kt)("p",null,"The first field is the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRunId")," of the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," which you intend to complete. The second is a map where each key is the name of a ",(0,r.kt)("inlineCode",{parentName:"p"},"field")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskDef"),", and the value is a ",(0,r.kt)("inlineCode",{parentName:"p"},"VariableValue")," representing the value of that User Task Field. The ",(0,r.kt)("inlineCode",{parentName:"p"},"user_id")," field must be set and is the ",(0,r.kt)("inlineCode",{parentName:"p"},"user_id")," of the person completing the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun"),"."),(0,r.kt)("p",null,"The current behavior of the ",(0,r.kt)("inlineCode",{parentName:"p"},"user_id")," field is that, if it differs from the current owner of the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun"),", then the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," will be re-assigned to the new ",(0,r.kt)("inlineCode",{parentName:"p"},"user_id"),". We have an ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/littlehorse-enterprises/littlehorse/issues/617"},"open ticket")," to make this behavior configurable. If this is an important feature for you, please comment on the ticket! We're happy to bump its priority; alternatively, we do accept Pull Requests \ud83d\ude04."),(0,r.kt)("p",null,"In the examples below, the user ",(0,r.kt)("inlineCode",{parentName:"p"},"alice")," will complete a ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," that has two fields: a ",(0,r.kt)("inlineCode",{parentName:"p"},"STR")," field called ",(0,r.kt)("inlineCode",{parentName:"p"},"model")," set to ",(0,r.kt)("inlineCode",{parentName:"p"},'"explorer"'),", and a ",(0,r.kt)("inlineCode",{parentName:"p"},"INT")," field called ",(0,r.kt)("inlineCode",{parentName:"p"},"year")," set to ",(0,r.kt)("inlineCode",{parentName:"p"},"2022"),"."),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"java",label:"Java",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'LittleHorseBlockingStub client = ...;\nUserTaskRunId id = ...; // For example, via searching as above\n\nclient.completeUserTaskRun(CompleteUserTaskRunRequest.newBuilder()\n        .setUserId("alice")\n        .putResults("model", LHLibUtil.objToVarVal("explorer"))\n        .putResults("year", LHLibUtil.objToVarVal(2022))\n        .setUserTaskRunId(id)\n        .build());\n'))),(0,r.kt)(s.Z,{value:"go",label:"Go",mdxType:"TabItem"},(0,r.kt)("p",null,"Go example coming soon. However, it should be highly similar to the Java example above.")),(0,r.kt)(s.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("p",null,"Python example coming soon. However, it should be highly similar to the Java example above."))),(0,r.kt)("h2",{id:"re-assign-a-usertaskrun"},"Re-Assign a ",(0,r.kt)("inlineCode",{parentName:"h2"},"UserTaskRun")),(0,r.kt)("p",null,"When building a task manager application, you may wish to have an administrative panel in which an admin may assign or re-assign tasks to various people. To re-assign a ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun"),", you can use the request ",(0,r.kt)("inlineCode",{parentName:"p"},"rpc AssignUserTaskRun"),". The request proto is as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},"message AssignUserTaskRunRequest {\n  UserTaskRunId user_task_run_id = 1;\n\n  bool override_claim = 2;\n\n  optional string user_group = 3;\n  optional string user_id = 4;\n}\n")),(0,r.kt)("p",null,"If the ",(0,r.kt)("inlineCode",{parentName:"p"},"override_claim")," field is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"false")," and the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," is already assigned to a specific ",(0,r.kt)("inlineCode",{parentName:"p"},"user_id"),", then the request will fail with ",(0,r.kt)("inlineCode",{parentName:"p"},"FAILED_PRECONDITION"),"."),(0,r.kt)("p",null,"It is important to note that the request will ",(0,r.kt)("em",{parentName:"p"},"overwrite")," both the ",(0,r.kt)("inlineCode",{parentName:"p"},"user_id")," ",(0,r.kt)("em",{parentName:"p"},"and")," the ",(0,r.kt)("inlineCode",{parentName:"p"},"user_group")," with the provided values from this request. If the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," is currently assigned to ",(0,r.kt)("inlineCode",{parentName:"p"},"user_group == 'sales'")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"user_id == null"),", and a client makes the following request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n    user_task_run_id: ...,\n    override_claim: false,\n    user_group: null,\n    user_id: "sarah"\n}\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," will be assigned to ",(0,r.kt)("inlineCode",{parentName:"p"},'user_id: "sarah"')," and ",(0,r.kt)("inlineCode",{parentName:"p"},"user_group: null"),". An example request is shown below."),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"java",label:"Java",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'LittleHorseBlockingStub client = ...;\nUserTaskRunId id = ...; // For example, via searching as above\n\nclient.assignUserTaskRun(AssignUserTaskRunRequest.newBuilder()\n        .setUserId("bob")\n        .setUserGroup("sales")\n        .setUserTaskRunId(id)\n        .setOverrideClaim(true)\n        .build());\n'))),(0,r.kt)(s.Z,{value:"go",label:"Go",mdxType:"TabItem"},(0,r.kt)("p",null,"Go example coming soon. However, it should be highly similar to the Java example above.")),(0,r.kt)(s.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("p",null,"Python example coming soon. However, it should be highly similar to the Java example above."))),(0,r.kt)("h2",{id:"cancel-a-usertaskrun"},"Cancel a ",(0,r.kt)("inlineCode",{parentName:"h2"},"UserTaskRun")),(0,r.kt)("p",null,'The last useful operation you may need to do when building an application using User Tasks is to "cancel" a ',(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun"),"."),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"Currently, when a ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," is moved to the ",(0,r.kt)("inlineCode",{parentName:"p"},"CANCELLED")," state, the ",(0,r.kt)("inlineCode",{parentName:"p"},"NodeRun")," treats it as an ",(0,r.kt)("inlineCode",{parentName:"p"},"ERROR")," condition. However, we have an ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/littlehorse-enterprises/littlehorse/issues/599"},"open ticket")," to change this behavior to throw a business ",(0,r.kt)("inlineCode",{parentName:"p"},"EXCEPTION")," rather than a technical ",(0,r.kt)("inlineCode",{parentName:"p"},"ERROR"),". This is because the cancellation of a ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," is a business process-level failure, not a technical failure."),(0,r.kt)("p",{parentName:"admonition"},"We anticipate implementing that ticket before releasing ",(0,r.kt)("inlineCode",{parentName:"p"},"1.0.0"),".")),(0,r.kt)("p",null,"The request ",(0,r.kt)("inlineCode",{parentName:"p"},"rpc CancelUserTaskRun")," is quite simple. The only edge-case is that the request throws ",(0,r.kt)("inlineCode",{parentName:"p"},"FAILED_PRECONDITION")," if the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserTaskRun")," is already in the ",(0,r.kt)("inlineCode",{parentName:"p"},"DONE")," status."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},"message CancelUserTaskRunRequest {\n  UserTaskRunId user_task_run_id = 1;\n}\n")),(0,r.kt)("p",null,"A simple example is shown below:"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"java",label:"Java",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"LittleHorseBlockingStub client = ...;\nUserTaskRunId id = ...; // For example, via searching as above\n\nclient.cancelUserTaskRun(CancelUserTaskRunRequest.newBuilder()\n        .setUserTaskRunId(id)\n        .build());\n"))),(0,r.kt)(s.Z,{value:"go",label:"Go",mdxType:"TabItem"},(0,r.kt)("p",null,"Go example coming soon. However, it should be highly similar to the Java example above.")),(0,r.kt)(s.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("p",null,"Python example coming soon. However, it should be highly similar to the Java example above."))))}c.isMDXComponent=!0}}]);